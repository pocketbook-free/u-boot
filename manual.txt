Инструкции по использованию

0. Введение
Из данных исходников можно собрать 2 варианта uboot
 1) для загрузки с внутренней памяти
 2) для загрузки с внешней карточки (mmc)

1. Сборка
   
  Шаг 0: Установка исходных текстов

Заходим в вашу рабочую директорию где будет происходить сборка
$ cd $USER_WORK_DIR
$ tar xjf ${PATH_TO_UBOOT_SRC}/uboot_pb.tar.bz2
$ cd uboot_pb

  Шаг 1: Настраиваем пути к кросс-компилятору
Если путь к кросс-компилятору уже присутствует в ваших переменных окружения, этот шаг можно пропустить
Для моей конфигурации настройка выглядит следующим образом
$ cd ~/PBSDK/arm-none-linux-gnueabi-gcc/bin
$ export PATH=$PWD:$PATH
$ cd -

В результате у вас должна успешно выполниться следующая команда:

$ arm-none-linux-gnueabi-gcc -v

Если вы используете другой кросс-компилятор, то можно отредактировать Makefile в строке 145, либо перед сборкой задавать переменную окружения "CROSS_COMPILE=arm-s3c6410-eabi-", где аргумент это название вашего кросс-компилятора.

  Шаг 2: 

Сборка осуществляется запуском скрипта make.sh с указанием соответствующего устройства, для которого нужно собрать u-boot. 

$ sh make.sh ep3

На выходе должен получиться файл u-boot.bin размером меньше 256 килобайт

  Шаг 3: Установка загрузчика на устройство

Здесь подразумевается что у вас есть "root" доступ, либо вы используете свободную прошивку от Pocketbook, поскольку требуется доступ к консоли с правами root пользователя.

Переписывает u-boot.bin и write_uboot.sh с ПК на внешнюю карточку:
$ cp write_uboot.sh u-boot.bin /media/${YOUR_SDCARD}/ && sync
Извлекаем карточку из кардридера
$ sudo eject /dev/${YOUR_SDCARD}

Вставляем карточку в устройство
# cd /mnt/ext2
№ sh write_uboot.sh mmcblk0
Если все прошло удачно, то выполняем перезагрузку
# reboot

Если все прошло удачно, то должен загрузиться новый u-boot, если нет, то можно начинать искать телефон сервисного центра))



Для упрощения процесса разработки, включена поддержка загрузки с внешней карточки. Для этого нужно собрать u-boot специальным скриптом, записать его на карточку памяти, так же записать туда ядро и корневую файловую систему.

$ sh make_ex.sh ep3
Пишет на карточку памяти
$ sudo sh write_uboot_ex.sh $EXTERNAL_SDCARD
где EXTERNAL_SDCARD это имя вашей карточки, т.е. если ваша карточка определилась как /dev/sdf, то EXTERNAL_SDCARD это "sdf".
Далее нужно записать ядро и файловую систему

Для записи ядра нужно:
$ KOFF=$(($(cat /sys/block/sda/size) - 8754))
$ sudo dd if=zImage of=/dev/${EXTERNAL_SDCARD} bs=512 seek=$KOFF && sync

Необходимо указать раздел, с которого будет грузиться rootfs, это можно сделать указать соответствующее значение ключа bootcmd в uboot.

